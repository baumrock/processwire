function InputfieldRepeater($){var depthSize=50,isAdminDefault=$("body").hasClass("AdminThemeDefault"),doubleClickTimer=null,currentlyAddingItem=!1,insertTimeout=null,eventReloaded=function(event,source){if(void 0===source||"InputfieldRepeaterItemEdit"!=source&&"InputfieldRepeaterItemAdd"!=source)initRepeater($(this));else{event.stopPropagation();var $r=$(this).find(".InputfieldRepeater");$r.length&&$r.each((function(){initRepeater($(this))}))}},eventDeleteClick=function(e){var $this=$(this),$header=$this.closest(".InputfieldHeader"),$item=$header.parent();if(isActionDisabled($this))return!1;if($item.hasClass("InputfieldRepeaterNewItem")){var $numAddInput=$item.children(".InputfieldContent").children(".InputfieldRepeaterAddItem").children("input");$numAddInput.attr("value",parseInt($numAddInput.attr("value")-1)),$item.remove()}else{var pageID=$item.attr("data-page"),$checkbox=$item.find("#delete_repeater"+pageID);$checkbox.is(":checked")?($checkbox.prop("checked",!1),$header.removeClass("ui-state-error").addClass("ui-state-default"),$item.removeClass("InputfieldRepeaterDeletePending").trigger("repeaterundelete")):($checkbox.prop("checked",!0),$header.removeClass("ui-state-default").addClass("ui-state-error"),$item.hasClass("InputfieldStateCollapsed")||$header.find(".toggle-icon").click(),$item.addClass("InputfieldRepeaterDeletePending").trigger("repeaterdelete"),$item.closest(".Inputfield").addClass("InputfieldStateChanged")),$header.find(".InputfieldRepeaterItemControls").css("background-color",$header.css("background-color"))}checkMinMax($item.closest(".InputfieldRepeater")),e.stopPropagation()},eventDeleteDblClick=function(){var $this=$(this),$li=$(this).closest("li"),undelete=$li.hasClass("InputfieldRepeaterDeletePending");if(isActionDisabled($this))return!1;function selectAll(){$li.parent().children("li").each((function(){var $item=$(this),$trashLink=$item.children(".InputfieldHeader").find(".InputfieldRepeaterTrash");$item.hasClass("InputfieldRepeaterDeletePending")?undelete&&$trashLink.click():undelete||$trashLink.click()}))}undelete?selectAll():ProcessWire.confirm(ProcessWire.config.InputfieldRepeater.labels.removeAll,selectAll)},eventCloneClick=function(){var $this=$(this);if(isActionDisabled($this))return!1;var $item=$this.closest(".InputfieldRepeaterItem");return ProcessWire.confirm(ProcessWire.config.InputfieldRepeater.labels.clone,(function(){var itemID=$item.attr("data-page"),$addLink=$item.closest(".InputfieldRepeater").children(".InputfieldContent").children(".InputfieldRepeaterAddItem").find(".InputfieldRepeaterAddLink:eq(0)");$item.siblings(".InputfieldRepeaterInsertItem").remove();var depth=getItemDepth($item),$newItem=$item.siblings(".InputfieldRepeaterNewItem").clone(),$nextItem=$item.next(".InputfieldRepeaterItem"),nextItemDepth=$nextItem.length?getItemDepth($nextItem):depth,$prevItem=$item.prev(".InputfieldRepeaterItem"),prevItemDepth=$prevItem.length?getItemDepth($prevItem):depth,insertBefore=depth<nextItemDepth;depth<nextItemDepth&&(insertBefore=!0),$newItem.addClass("InputfieldRepeaterInsertItem").attr("id",$newItem.attr("id")+"-clone"),$newItem.find(".InputfieldHeader").html("<i class='fa fa-spin fa-spinner'></i>"),insertBefore?(depth=getInsertBeforeItemDepth($item),$newItem.addClass("InputfieldRepeaterInsertItemBefore"),$newItem.insertBefore($item)):(depth=getInsertAfterItemDepth($item),$newItem.addClass("InputfieldRepeaterInsertItemAfter"),$newItem.insertAfter($item)),setItemDepth($newItem,depth),$newItem.show(),$addLink.attr("data-clone",itemID).click()})),!1},eventCopyCloneClick=function(){if(isActionDisabled($(this)))return!1;var labels=ProcessWire.config.InputfieldRepeater.labels,$item=$(this).closest(".InputfieldRepeaterItem"),itemID=$item.attr("data-page"),$inputfield=$item.closest(".InputfieldRepeater"),fieldName,cookieName=copyPasteCookieName($inputfield.attr("data-name")),copyValue=jQuery.cookie(cookieName),itemLabel=getItemLabel($item).text(),pasteID=copyValue?parseInt(copyValue.item):"",pasteDisabled=copyValue?"":"disabled ",pasteSelected=pasteID>0?"selected ":"",note="";pasteID>0&&(note="<div style='margin-top:8px'><i class='fa fa-paste fa-fw'></i>"+labels.copyInMemory+" (id "+pasteID+")</div>");var input='<option value="copy">'+labels.copy+'</option><option value="clone-before">'+labels.cloneBefore+'</option><option value="clone-after">'+labels.cloneAfter+"</option><option "+pasteDisabled+'value="paste-before">'+labels.pasteBefore+"</option><option "+pasteDisabled+pasteSelected+'value="paste-after">'+labels.pasteAfter+"</option><option "+pasteDisabled+'value="clear">'+labels.clear+"</option>";note.length&&(note="<span class='detail'>"+note+"</span>");var options={message:labels.selectAction+" (id "+itemID+")",input:'<select name="action" class="uk-select">'+input+"</select>"+note,callback:function(value){var action=value.action;"copy"===action?(copyRepeaterItem($item),$item.fadeOut("fast",(function(){$item.fadeIn("fast")})),$inputfield.addClass("InputfieldRepeaterCanPaste")):"clone-before"===action?cloneRepeaterItem($item,!0):"clone-after"===action?cloneRepeaterItem($item,!1):"paste-before"===action?pasteRepeaterItem($item,!0):"paste-after"===action?pasteRepeaterItem($item,!1):"clear"===action?(jQuery.cookie(cookieName,null),$inputfield.removeClass("InputfieldRepeaterCanPaste")):console.log("unknown action: "+action)}};return vex.dialog.open(options),!1},eventSettingsClick=function(e){var $this=$(this),$item=$this.closest(".InputfieldRepeaterItem"),$settingsParent=$item.children(".InputfieldContent").children(".Inputfields"),$settings=$settingsParent.children(".InputfieldRepeaterSettings");return $settings.length||($settings=($settingsParent=$settingsParent.children(".InputfieldWrapper").children(".Inputfields")).children(".InputfieldRepeaterSettings")),$item.hasClass("InputfieldStateCollapsed")&&$this.closest(".InputfieldHeader").click(),$settings.is(":visible")?($settings.slideUp("fast"),$this.addClass("ui-priority-secondary")):($settings.slideDown("fast"),$this.removeClass("ui-priority-secondary")),!1},eventToggleClick=function(e){var $this=$(this),toggleOn=$this.attr("data-on"),toggleOff=$this.attr("data-off"),$item=$this.closest(".InputfieldRepeaterItem"),$input=$item.find(".InputfieldRepeaterPublish");doubleClickTimer&&clearTimeout(doubleClickTimer),doubleClickTimer=setTimeout((function(){if(isActionDisabled($this))return!1;$this.hasClass(toggleOn)?($this.removeClass(toggleOn).addClass(toggleOff),$item.addClass("InputfieldRepeaterUnpublished InputfieldRepeaterOff"),$input.val("-1")):($this.removeClass(toggleOff).addClass(toggleOn),$item.removeClass("InputfieldRepeaterUnpublished InputfieldRepeaterOff").addClass("InputfieldRepeaterWasUnpublished"),$input.val("1")),$input.trigger("change"),checkMinMax($item.closest(".InputfieldRepeater"))}),250),e.stopPropagation()},eventItemOpenReady=function(){var $item=$(this),$loaded=$item.find(".InputfieldRepeaterLoaded");parseInt($loaded.val())>0||$item.addClass("InputfieldRepeaterItemLoading")},eventItemOpened=function(){var $item=$(this),$loaded=$item.find(".InputfieldRepeaterLoaded");if(updateState($item),parseInt($loaded.val())>0)updateAccordion($item);else{$loaded.val("1");var $content=$item.find(".InputfieldContent").hide(),$repeater=$item.closest(".InputfieldRepeater"),pageID=$repeater.attr("data-page"),itemID=parseInt($item.attr("data-page")),repeaterID=$repeater.attr("id"),fieldName=$repeater.attr("data-name"),ajaxURL=ProcessWire.config.InputfieldRepeater.editorUrl+"?id="+pageID+"&field="+fieldName+"&repeater_edit="+itemID,$spinner=$item.find(".InputfieldRepeaterDrag"),$inputfields=$loaded.closest(".Inputfields");$repeater.hasClass("InputfieldRenderValueMode")&&(ajaxURL+="&inrvm=1"),$repeater.hasClass("InputfieldNoDraft")&&(ajaxURL+="&nodraft=1"),$spinner.removeClass("fa-arrows").addClass("fa-spin fa-spinner"),repeaterID=repeaterID.replace(/_repeater\d+$/,"").replace("_LPID"+pageID,""),$.get(ajaxURL,(function(data){var $inputs=$(data).find("#"+repeaterID+" > .InputfieldContent > .Inputfields > .InputfieldRepeaterItem > .InputfieldContent > .Inputfields > .InputfieldWrapper > .Inputfields > .Inputfield");$inputfields.append($inputs),$item.removeClass("InputfieldRepeaterItemLoading"),InputfieldsInit($inputfields);var $repeaters=$inputs.find(".InputfieldRepeater");$repeaters.length?$repeaters.each((function(){initRepeater($(this))})):$item.find(".InputfieldRepeaterSettings").hide(),$content.slideDown("fast",(function(){$spinner.removeClass("fa-spin fa-spinner").addClass("fa-arrows"),updateAccordion($item)})),setTimeout((function(){$inputfields.find(".Inputfield").trigger("reloaded",["InputfieldRepeaterItemEdit"])}),50),runScripts(data)}))}},eventItemClosed=function(){updateState($(this))},eventAddLinkClick=function(){currentlyAddingItem=!0;var $addLink=$(this),$inputfields=$addLink.parent("p").prev("ul.Inputfields"),$inputfieldRepeater=$addLink.closest(".InputfieldRepeater"),$numAddInput=$addLink.parent().children("input"),newItemTotal=0,useAjax=0==$addLink.attr("data-noajax").length,cloneID=$addLink.attr("data-clone"),pageID=0,depth=0,redoSortAll=!1,inputfieldPageID=parseInt($inputfieldRepeater.attr("data-page"));function addRepeaterItem($addItem){for(var id=$addItem.attr("id")+"_";$("#"+id).length>0;)id+="_";$addItem.attr("id",id);var $insertItem=$inputfields.children(".InputfieldRepeaterInsertItem");if($insertItem.length){depth=getItemDepth($insertItem),$addItem.addClass("InputfieldStateCollapsed");var $toggleIcon=$addItem.children(".InputfieldHeader").find(".toggle-icon");$toggleIcon.toggleClass($toggleIcon.attr("data-to")),$insertItem.replaceWith($addItem),redoSortAll=!0}else $inputfields.append($addItem);$addItem.css("display","block"),adjustItemLabel($addItem,!0),$addLink.trigger("repeateradd",[$addItem])}if(void 0!==cloneID&&cloneID||(cloneID=null),cloneID&&($addLink.removeAttr("data-clone"),cloneID.indexOf(":")>0)){var a=cloneID.split(":");pageID=parseInt(a[0]),cloneID=parseInt(a[1])}if(!useAjax){var $newItem=$inputfields.children(".InputfieldRepeaterNewItem");if((newItemTotal=$newItem.length)>0){newItemTotal>1&&($newItem=$newItem.slice(0,1));var $addItem=$newItem.clone(!0);depth&&setItemDepth($addItem,depth),addRepeaterItem($addItem),$numAddInput.attr("value",newItemTotal),checkMinMax($inputfieldRepeater)}return currentlyAddingItem=!1,!1}pageID||(pageID=inputfieldPageID);var fieldName=$inputfieldRepeater.attr("data-name"),$spinner=$addLink.parent().find(".InputfieldRepeaterSpinner"),ajaxURL=ProcessWire.config.InputfieldRepeater.editorUrl+"?id="+pageID+"&field="+fieldName;$spinner.removeClass($spinner.attr("data-off")).addClass($spinner.attr("data-on")),ajaxURL+=cloneID?"&repeater_clone="+cloneID+"&repeater_clone_to="+inputfieldPageID:"&repeater_add="+$addLink.attr("data-type");var $existingItems=$inputfields.find(".InputfieldRepeaterItem:not(.InputfieldRepeaterNewItem)");return $existingItems.length&&(ajaxURL+="&repeater_not=",$existingItems.each((function(){ajaxURL+=$(this).attr("data-page")+","}))),$.get(ajaxURL,(function(data){$spinner.removeClass($spinner.attr("data-on")).addClass($spinner.attr("data-off"));var $addItem=$(data).find(".InputfieldRepeaterItemRequested");if($addItem.length){addRepeaterItem($addItem),$addItem.wrap("<div />"),InputfieldsInit($addItem.parent()),initRepeater($addItem),$addItem.unwrap(),$addItem.find(".Inputfield").trigger("reloaded",["InputfieldRepeaterItemAdd"]),cloneID&&($addItem.find(".Inputfield").trigger("cloned",["InputfieldRepeaterItemAdd"]),$addItem.find(".InputfieldTableRowID").val(0)),redoSortAll?$inputfields.children(".InputfieldRepeaterItem").each((function(n){setItemSort($(this),n)})):setItemSort($addItem,$inputfields.children().length),depth&&setItemDepth($addItem,depth),$addItem.hasClass("InputfieldStateCollapsed")||$("html, body").animate({scrollTop:$addItem.offset().top},500,"swing"),updateState($addItem),checkMinMax($inputfieldRepeater),updateAccordion($addItem);var $nestedRepeaters=$addItem.find(".InputfieldRepeater");$nestedRepeaters.length&&$nestedRepeaters.each((function(){initRepeater($(this))})),runScripts(data),setTimeout((function(){currentlyAddingItem=!1}),500)}})),!1},eventOpenAllClick=function(e){if(e.stopPropagation(),e.preventDefault(),doubleClickTimer&&clearTimeout(doubleClickTimer),$(this).closest(".InputfieldRepeater").hasClass("InputfieldRepeaterAccordion"))return!1;var $repeater,$items=$(this).closest(".InputfieldRepeater").children(".InputfieldContent").children(".Inputfields").children(".InputfieldRepeaterItem"),$item,label,selector;return!!$items.length&&($items.eq(0).hasClass("InputfieldStateCollapsed")?(label=ProcessWire.config.InputfieldRepeater.labels.openAll,selector=".InputfieldStateCollapsed"):(label=ProcessWire.config.InputfieldRepeater.labels.collapseAll,selector=".InputfieldRepeaterItem:not(.InputfieldStateCollapsed)"),ProcessWire.confirm(label,(function(){$items.filter(selector).each((function(){$(this).children(".InputfieldHeader").find(".toggle-icon").click()}))})),!1)},eventInsertBeforeClick=function(e){var $item;eventInsertClick($(this).closest(".InputfieldRepeaterItem"),!0),e.stopPropagation()},eventInsertAfterClick=function(e){var $item;eventInsertClick($(this).closest(".InputfieldRepeaterItem"),!1),e.stopPropagation()};function eventInsertClick($item,insertBefore){if(currentlyAddingItem)return!1;currentlyAddingItem=!0,insertTimeout&&clearTimeout(insertTimeout);var depth=getInsertItemDepth($item,insertBefore),$oldInsertItem=$item.siblings(".InputfieldRepeaterInsertItem");$oldInsertItem.length&&$oldInsertItem.remove();var $insertItem=$item.siblings(".InputfieldRepeaterNewItem").clone().removeClass(".InputfieldRepeaterNewItem").addClass("InputfieldRepeaterInsertItem");$insertItem.attr("id",$insertItem.attr("id")+"-placeholder"),$insertItem.find(".InputfieldHeader").html("<i class='fa fa-spin fa-spinner'></i>"),insertBefore?$insertItem.insertBefore($item):$insertItem.insertAfter($item),depth>0&&setItemDepth($insertItem,depth),$insertItem.show(),insertBefore||$item.hasClass("InputfieldStateCollapsed")||scrollToItem($insertItem),$insertItem.children(".InputfieldHeader").effect("highlight",{},500);var $addLinks=$item.parent(".Inputfields").siblings(".InputfieldRepeaterAddItem").find(".InputfieldRepeaterAddLink");1===$addLinks.length?$addLinks.eq(0).click():$addLinks.length>1&&($item.trigger("repeaterinsert",[$insertItem,$item,insertBefore]),currentlyAddingItem=!1)}var eventPasteClick=function(e){var $inputfield,$newItem;return pasteRepeaterItem($(this).closest(".InputfieldRepeater").children(".InputfieldContent").children(".Inputfields").children(".InputfieldRepeaterNewItem"),!1),!1},eventInsertMouseout=function(e){if(!currentlyAddingItem){insertTimeout&&clearTimeout(insertTimeout);var $action=$(this),$newItem=$action.data("newItem");if($action.removeClass("hov"),$newItem&&$newItem.length){if($newItem.hasClass("hov"))return;$newItem.remove()}}},eventInsertMouseover=function(e){if(!currentlyAddingItem){insertTimeout&&clearTimeout(insertTimeout);var $action=$(this),insertBefore=$action.hasClass("InputfieldRepeaterInsertBefore"),$item=$(this).closest(".InputfieldRepeaterItem"),depth=0;$item.siblings(".InputfieldRepeaterInsertItem").remove();var $newItem=$item.siblings(".InputfieldRepeaterNewItem").clone();$newItem.addClass("InputfieldRepeaterInsertItem").attr("id",$newItem.attr("id")+"-insert"),insertBefore?(depth=getInsertBeforeItemDepth($item),$newItem.addClass("InputfieldRepeaterInsertItemBefore"),$newItem.addClass("hov")):(depth=getInsertAfterItemDepth($item),$newItem.addClass("InputfieldRepeaterInsertItemAfter")),$newItem.find(".InputfieldRepeaterItemControls").hide(),$newItem.find(".InputfieldRepeaterItemLabel").text(ProcessWire.config.InputfieldRepeater.labels.insertHere),$action.addClass("hov").data("newItem",$newItem),setItemDepth($newItem,depth),insertTimeout=setTimeout((function(){insertTimeout=null,$action.hasClass("hov")?(insertBefore?$newItem.insertBefore($item):$newItem.addClass("hov").insertAfter($item),$newItem.on("mouseover",(function(){$(this).addClass("hov")})).on("click",(function(e){e.stopPropagation(),eventInsertClick($item,insertBefore)})).on("mouseout",(function(){$(this).removeClass("hov").remove()})),$newItem.slideDown()):$newItem.remove()}),1e3)}};function isActionDisabled($this){return!!$this.hasClass("pw-icon-disabled")&&(ProcessWire.alert(ProcessWire.config.InputfieldRepeater.labels.disabledMinMax),!0)}function updateAccordion($item){if(!$item.closest(".InputfieldRepeater").hasClass("InputfieldRepeaterAccordion"))return!1;var itemID=$item.attr("id"),useScroll=!1,$siblings=$item.parent().children(".InputfieldRepeaterItem"),itemHasPassed=!1,hasOpen=!1;return $siblings.each((function(){var $sibling=$(this);$sibling.attr("id")!=itemID?$sibling.hasClass("InputfieldStateCollapsed")||$sibling.is(":visible")&&(itemHasPassed||(useScroll=!0),$sibling.children(".InputfieldHeader").find(".toggle-icon").trigger("click",[{duration:0}]),hasOpen=!0):itemHasPassed=!0})),useScroll&&hasOpen&&scrollToItem($item),!0}function adjustItemLabel($item,doIncrement){var $label;void 0===($label=$item.children(".InputfieldHeader").find(".InputfieldRepeaterItemLabel"))&&($label=$item.children("label"));var labelHTML=$label.html(),_labelHTML=labelHTML;if(void 0!==labelHTML){if(doIncrement&&labelHTML.indexOf("#")>-1){var num=$item.siblings(".InputfieldRepeaterItem:visible").length+1;labelHTML=labelHTML.replace(/#[0-9]+/,"#"+num)}for(;labelHTML.indexOf("}")>-1;)labelHTML=(labelHTML=labelHTML.replace(/\{/,'<span class="ui-priority-secondary" style="font-weight:normal">')).replace(/}/,"</span>");labelHTML!=_labelHTML&&$label.html(labelHTML)}}function getItemLabel($item){return $item.children(".InputfieldHeader").children(".InputfieldRepeaterItemLabel")}function setItemSort($item,sort){var $input=getItemSortInput($item);$input.length&&$input.val(sort)}function getItemSort($item){var $input=getItemSortInput($item);return $input.length?parseInt($input.val()):-1}function getItemSortInput($item){return $item.hasClass("InputfieldRepeaterItem")||($item=$item.closest(".InputfieldRepeaterItem")),$item.children(".InputfieldContent").children(".Inputfields").children(".InputfieldRepeaterItemSort").find(".InputfieldRepeaterSort")}function sortableItemAllowed($item){return!$item.hasClass("InputfieldRepeaterMatrixItem")||"undefined"==typeof InputfieldRepeaterMatrixTools||InputfieldRepeaterMatrixTools.sortableItemAllowed($item)}function sortableDepth(ui,maxDepth,updateNow){var $wrap,$depth=ui.item.children(".InputfieldContent").children(".Inputfields").children(".InputfieldRepeaterItemDepth").find("input"),depth=-1,prevDepth=parseInt($depth.val()),left=ui.position.left;return depth=left<0?prevDepth-Math.round(Math.abs(left)/50):Math.round(left/50)+prevDepth,updateNow&&(depth=setItemDepth(ui.item,depth,maxDepth),ui.item.children(".InputfieldHeader").removeClass("ui-state-error")),depth}function setItemDepth($item,depth,maxDepth,noValidate){if(noValidate=void 0!==noValidate&&noValidate,depth<1&&(depth=0),void 0!==maxDepth&&depth>maxDepth&&(depth=maxDepth),$item.hasClass("InputfieldRepeaterItem")||($item=$item.closest(".InputfieldRepeaterItem")),!$item.length)return-1;var $depthInput=$item.children(".InputfieldContent").children(".Inputfields").children(".InputfieldRepeaterItemDepth").find("input");if($depthInput.length||$item.hasClass("InputfieldRepeaterNewItem")||console.log("Cannot find depth input for "+$item.attr("id")),!noValidate&&$item.closest(".InputfieldRepeater").hasClass("InputfieldRepeaterFamilyFriendly")){var $prevItem=$item.prev(".InputfieldRepeaterItem:not(.InputfieldRepeaterNewItem)");if($prevItem.length){var prevItemDepth=parseInt($prevItem.attr("data-depth"));depth-prevItemDepth>1&&(depth=prevItemDepth+1)}else depth=0}return $depthInput.val(depth),$item.attr("data-depth",depth),depth>0?($item.css("padding-left",50*depth+"px"),$item.addClass("InputfieldRepeaterItemHasDepth")):($item.css("padding-left",0),$item.removeClass("InputfieldRepeaterItemHasDepth")),depth}function getItemDepth($item){return $item.hasClass("InputfieldRepeaterItem")||($item=$item.closest(".InputfieldRepeaterItem")),$item.length?parseInt($item.attr("data-depth")):-1}function getInsertItemDepth($contextItem,insertBefore){var depth=0;if(insertBefore)depth=getItemDepth($contextItem);else{var $nextItem=$contextItem.next(".InputfieldRepeaterItem");depth=getItemDepth($contextItem),$nextItem.hasClass("InputfieldRepeaterNewItem")&&($nextItem.hasClass("InputfieldRepeaterInsertItem")||($nextItem=null));var nextDepth=$nextItem&&$nextItem.length?getItemDepth($nextItem):depth;nextDepth>depth&&(depth=nextDepth)}return depth}function getInsertBeforeItemDepth($item){return getInsertItemDepth($item,!0)}function getInsertAfterItemDepth($item){return getInsertItemDepth($item,!1)}function getDepthChildren($item){for(var children=[],n=0,startDepth=parseInt($item.attr("data-depth")),pageId,pageIdClass="Inputfield_repeater_item_"+$item.attr("data-page");$item.hasClass(pageIdClass);){var $nextItem=$item.next(".InputfieldRepeaterItem:not(.InputfieldRepeaterNewItem)");if(!$nextItem.length||!$nextItem.hasClass(pageIdClass))break;$item=$nextItem}for(;;){var $child=$item.next(".InputfieldRepeaterItem:not(.InputfieldRepeaterNewItem)");if(!$child.length)break;var childDepth=parseInt($child.attr("data-depth"));if(!childDepth||childDepth<=startDepth)break;$item=$child,children[n]=$child,n++}return children}function initDepths($inputfieldRepeater){$inputfieldRepeater.find(".InputfieldRepeaterItemDepth").each((function(){var $wrap,$depth=$(this).find("input"),depth=$depth.val(),$item=$depth.closest(".InputfieldRepeaterItem"),currentLeft=$item.css("padding-left");"auto"==currentLeft&&(currentLeft=0);var targetLeft=50*depth;targetLeft!=(currentLeft=parseInt(currentLeft))&&$item.css("padding-left",targetLeft+"px"),targetLeft>0?$item.addClass("InputfieldRepeaterItemHasDepth"):$item.removeClass("InputfieldRepeaterItemHasDepth")})),$inputfieldRepeater.children(".InputfieldContent").css("position","relative")}function initSortable($inputfieldRepeater,$inputfields){var maxDepth=parseInt($inputfieldRepeater.attr("data-depth")),depthChildren=[],startDepth=0,familyFriendly=$inputfieldRepeater.hasClass("InputfieldRepeaterFamilyFriendly"),sortableOptions={items:"> li:not(.InputfieldRepeaterNewItem)",handle:".InputfieldRepeaterDrag",start:function(e,ui){if(ui.item.find(".InputfieldHeader").addClass("ui-state-highlight"),ui.item.find("textarea.InputfieldCKEditorNormal.InputfieldCKEditorLoaded").each((function(){var editor;$(this).removeClass("InputfieldCKEditorLoaded"),CKEDITOR.instances[$(this).attr("id")].destroy(),CKEDITOR.remove($(this).attr("id"))})),familyFriendly&&maxDepth>0){startDepth=parseInt(ui.item.attr("data-depth")),depthChildren=getDepthChildren(ui.item);for(var n=0;n<depthChildren.length;n++)depthChildren[n].slideUp("fast")}},stop:function(e,ui){if(maxDepth>0&&sortableDepth(ui,maxDepth,!0),!sortableItemAllowed(ui.item))return!1;if(maxDepth>0&&familyFriendly&&depthChildren.length){for(var $item=ui.item,stopDepth,diffDepth=parseInt($item.attr("data-depth"))-startDepth,n=0;n<depthChildren.length;n++){var $child=depthChildren[n],itemDepth;if(0!=diffDepth)setItemDepth($child,getItemDepth($child)+diffDepth,maxDepth,!0);$item.after($child),$child.slideDown("fast"),$item=$child}depthChildren=[]}ui.item.find(".InputfieldHeader").removeClass("ui-state-highlight"),$(this).children().each((function(n){$(this).find(".InputfieldRepeaterSort").slice(0,1).attr("value",n)})),ui.item.find("textarea.InputfieldCKEditorNormal:not(.InputfieldCKEditorLoaded)").each((function(){$(this).closest(".InputfieldCKEditor").trigger("reloaded",["InputfieldRepeaterSort"])})),$(this).closest(".InputfieldRepeater").trigger("sorted",[ui.item])},update:function(e,ui){$inputfieldRepeater.addClass("InputfieldStateChanged")}};maxDepth>0?(initDepths($inputfieldRepeater),sortableOptions.grid=[50,1],sortableOptions.sort=function(event,ui){var depth=sortableDepth(ui,99,!1),$header=ui.item.children(".InputfieldHeader");depth>maxDepth?$header.addClass("ui-state-error InputfieldRepeaterItemOOB"):$header.hasClass("ui-state-error")&&$header.removeClass("ui-state-error InputfieldRepeaterItemOOB")}):sortableOptions.axis="y",$(".InputfieldRepeaterDrag",$inputfields).hover((function(){$(this).parent("label").addClass("ui-state-focus")}),(function(){$(this).parent("label").removeClass("ui-state-focus")})),$inputfields.sortable(sortableOptions)}function initHeaders($headers,$inputfieldRepeater,renderValueMode){var $clone=$("<i class='fa fa-copy InputfieldRepeaterClone'></i>").css("display","block"),$delete=$("<i class='fa fa-trash InputfieldRepeaterTrash'></i>"),$toggle=$("<i class='fa InputfieldRepeaterToggle' data-on='fa-toggle-on' data-off='fa-toggle-off'></i>"),$insertAfter=$("<i class='fa fa-download InputfieldRepeaterInsertAfter'></i>"),$insertBefore=$("<i class='fa fa-upload InputfieldRepeaterInsertBefore'></i>"),cfg=ProcessWire.config.InputfieldRepeater,allowClone=!$inputfieldRepeater.hasClass("InputfieldRepeaterNoAjaxAdd"),allowSettings=$inputfieldRepeater.hasClass("InputfieldRepeaterHasSettings");cfg&&($toggle.attr("title",cfg.labels.toggle),$delete.attr("title",cfg.labels.remove),$clone.attr("title",cfg.labels.clone),$insertBefore.attr("title",cfg.labels.insertBefore),$insertAfter.attr("title",cfg.labels.insertAfter)),allowSettings&&$inputfieldRepeater.find(".InputfieldRepeaterSettings").hide(),$headers.each((function(){var $t=$(this);if(!$t.hasClass("InputfieldRepeaterHeaderInit")){var $item=$t.parent(),icon=$item.attr("data-icon");if(void 0!==icon&&icon.length||(icon="fa-arrows"),0!==icon.indexOf("fa-")&&(icon="fa-"+icon),$item.hasClass("InputfieldRepeaterNewItem")&&(icon="fa-plus-circle",$t.addClass("ui-priority-secondary")),$t.addClass("ui-state-default InputfieldRepeaterHeaderInit"),$t.prepend("<i class='fa fa-fw "+icon+" InputfieldRepeaterDrag'></i>"),!renderValueMode){var $controls=$("<span class='InputfieldRepeaterItemControls'></span>"),$toggleControl=$toggle.clone(!0).addClass($t.parent().hasClass("InputfieldRepeaterOff")?"fa-toggle-off":"fa-toggle-on"),$deleteControl=$delete.clone(!0),$collapseControl=$t.find(".toggle-icon"),$insertBeforeControl=$insertBefore.clone(!0),$insertAfterControl=$insertAfter.clone(!0);$controls.prepend($collapseControl),$controls.prepend($insertBeforeControl),$controls.prepend($insertAfterControl);var $closestRepeater=$t.closest(".InputfieldRepeater");if($closestRepeater.hasClass("InputfieldRepeaterHasSettings")){var $settingsToggle=$("<i class='fa fa-gear InputfieldRepeaterSettingsToggle ui-priority-secondary'></i>").attr("title",cfg.labels.settings);$controls.prepend($settingsToggle)}!allowClone&&$closestRepeater.hasClass("InputfieldRepeaterNoAjaxAdd")||$controls.prepend($clone.clone(!0)),$controls.prepend($toggleControl),$controls.prepend($deleteControl),$t.prepend($controls),$controls.css("background-color",$t.css("background-color"))}adjustItemLabel($item,!1)}}))}function initRepeater($this){var $inputfields,$inputfieldRepeater,isItem;if($this.hasClass("InputfieldRepeaterItem")?($inputfields=$this,$inputfieldRepeater=$this.closest(".InputfieldRepeater"),isItem=!0):($inputfields=$this.find(".Inputfields:eq(0)"),$inputfieldRepeater=$this,isItem=!1),!$inputfields.hasClass("InputfieldRepeaterInit")){$("body").hasClass("touch-device")&&$inputfieldRepeater.addClass("InputfieldRepeaterLoudControls");var renderValueMode=$inputfields.closest(".InputfieldRenderValueMode").length>0;$inputfields.addClass("InputfieldRepeaterInit"),initHeaders(isItem?$this.children(".InputfieldHeader"):$(".InputfieldRepeaterItem > .InputfieldHeader",$this),$inputfieldRepeater,renderValueMode),renderValueMode?initDepths($inputfieldRepeater):($(".InputfieldRepeaterTrash",$this).hover((function(){var $label=$(this).closest("label");$label.parents().hasClass("InputfieldRepeaterDeletePending")||$label.addClass("ui-state-error"),$label.find(".InputfieldRepeaterItemControls").css("background-color",$label.css("background-color"))}),(function(){var $label=$(this).closest("label");$label.parent().hasClass("InputfieldRepeaterDeletePending")||$label.removeClass("ui-state-error"),$label.find(".InputfieldRepeaterItemControls").css("background-color",$label.css("background-color"))})),isItem&&($inputfields=$inputfieldRepeater.find(".Inputfields:eq(0)")),initSortable($inputfieldRepeater,$inputfields),$(".InputfieldRepeaterAddLink:not(.InputfieldRepeaterAddLinkInit)",$inputfieldRepeater).addClass("InputfieldRepeaterAddLinkInit").click(eventAddLinkClick),$inputfieldRepeater.hasClass("InputfieldRepeaterMax")&&checkMinMax($inputfieldRepeater))}}function checkMinMax($inputfieldRepeater){if($inputfieldRepeater.hasClass("InputfieldRepeaterMax")||$inputfieldRepeater.hasClass("InputfieldRepeaterMin")){var max=parseInt($inputfieldRepeater.attr("data-max")),min=parseInt($inputfieldRepeater.attr("data-min"));if(!(max<=0&&min<=0)){var $content=$inputfieldRepeater.children(".InputfieldContent"),num=$content.children(".Inputfields").children("li:not(.InputfieldRepeaterDeletePending):not(.InputfieldRepeaterOff):visible").length,$addItem=$content.children(".InputfieldRepeaterAddItem"),cloneChange="",trashChange="";if(max>0&&(num>=max?($addItem.hide(),cloneChange="hide"):$addItem.is(":visible")||($addItem.show(),cloneChange="show")),min>0&&(num<=min?(trashChange="hide",$content.addClass("InputfieldRepeaterTrashHidden")):$content.hasClass("InputfieldRepeaterTrashHidden")&&($content.removeClass("InputfieldRepeaterTrashHidden"),trashChange="show")),cloneChange.length||trashChange.length){var $items=$content.children(".Inputfields").children(".InputfieldRepeaterItem");cloneChange.length&&$items.each((function(){var $clone=$(this).children(".InputfieldHeader").find(".InputfieldRepeaterClone");"show"===cloneChange?$clone.removeClass("pw-icon-disabled"):$clone.addClass("pw-icon-disabled")})),trashChange.length&&($items.each((function(){var $header=$(this).children(".InputfieldHeader"),$trash=$header.find(".InputfieldRepeaterTrash"),$toggle=$header.find(".InputfieldRepeaterToggle.fa-toggle-on");"show"===trashChange?($trash.removeClass("pw-icon-disabled"),$toggle.removeClass("pw-icon-disabled")):($trash.addClass("pw-icon-disabled"),$toggle.addClass("pw-icon-disabled"))})),"hide"==trashChange&&$content.children(".Inputfields").children("li.InputfieldRepeaterDeletePending").each((function(){var $trash;$(this).children(".InputfieldHeader").find(".InputfieldRepeaterTrash").removeClass("pw-icon-disabled")})))}}}}function scrollToItem($item){$("html, body").animate({scrollTop:$item.offset().top-10},250,"swing")}function runScripts(data){if(-1!=data.indexOf("<\/script>")){var d=document.createElement("div");d.innerHTML=data;var scripts=d.querySelectorAll(".Inputfield script");$(scripts).each((function(){$.globalEval(this.text||this.textContent||this.innerHTML||"")}))}}function updateState($item){if(!($item.closest(".InputfieldRepeaterRememberOpen").length<1)){var val="";$(".InputfieldRepeaterItem:not(.InputfieldStateCollapsed)").each((function(){var id=parseInt($(this).attr("data-page"));id>0&&(val+=id+"|")})),$.cookie("repeaters_open",val)}}function cloneRepeaterItem($item,insertBefore,pasteValue){void 0===pasteValue&&(pasteValue=null);var actionName=null===pasteValue?"clone":"paste",$addLink=$item.closest(".InputfieldRepeater").children(".InputfieldContent").children(".InputfieldRepeaterAddItem").find(".InputfieldRepeaterAddLink:eq(0)");$item.siblings(".InputfieldRepeaterInsertItem").remove();var depth=getItemDepth($item),$newItem=$item.hasClass("InputfieldRepeaterNewItem")?$item.clone():$item.siblings(".InputfieldRepeaterNewItem").clone(),$nextItem=$item.next(".InputfieldRepeaterItem"),nextItemDepth=$nextItem.length?getItemDepth($nextItem):depth,$prevItem=$item.prev(".InputfieldRepeaterItem"),prevItemDepth=$prevItem.length?getItemDepth($prevItem):depth;void 0===insertBefore&&(insertBefore=depth<nextItemDepth),$newItem.addClass("InputfieldRepeaterInsertItem").attr("id",$newItem.attr("id")+"-"+actionName),$newItem.find(".InputfieldHeader").html("<i class='fa fa-spin fa-spinner'></i>"),insertBefore?(depth=getInsertBeforeItemDepth($item),$newItem.addClass("InputfieldRepeaterInsertItemBefore"),$newItem.insertBefore($item)):(depth=getInsertAfterItemDepth($item),$newItem.addClass("InputfieldRepeaterInsertItemAfter"),$newItem.insertAfter($item)),setItemDepth($newItem,depth),$newItem.show(),"paste"===actionName?$addLink.attr("data-clone",pasteValue.page+":"+pasteValue.item).click():$addLink.attr("data-clone",$item.attr("data-page")).click()}function pasteRepeaterItem($item,insertBefore){var $inputfield,fieldName,cookieName=copyPasteCookieName($item.closest(".InputfieldRepeater").attr("data-name")),copyValue=jQuery.cookie(cookieName);copyValue&&cloneRepeaterItem($item,insertBefore,copyValue)}function copyRepeaterItem($item){var $title=$("#Inputfield_title"),$name=$("#Inputfield__pw_page_name"),$inputfield=$item.closest(".InputfieldRepeater"),fieldName=$inputfield.attr("data-name"),copyValue={page:parseInt($inputfield.attr("data-page")),item:parseInt($item.attr("data-page")),field:fieldName},cookieName=copyPasteCookieName(fieldName);jQuery.cookie(cookieName,copyValue)}function copyPasteCookieName(fieldName){return fieldName+"_copy"}function init(){$(".InputfieldRepeater").each((function(){initRepeater($(this))})),$(document).on("reloaded",".InputfieldRepeater",eventReloaded).on("click",".InputfieldRepeaterTrash",eventDeleteClick).on("dblclick",".InputfieldRepeaterTrash",eventDeleteDblClick).on("click",".InputfieldRepeaterClone",eventCopyCloneClick).on("click",".InputfieldRepeaterPaste",eventPasteClick).on("click",".InputfieldRepeaterSettingsToggle",eventSettingsClick).on("dblclick",".InputfieldRepeaterToggle",eventOpenAllClick).on("click",".InputfieldRepeaterToggle",eventToggleClick).on("opened",".InputfieldRepeaterItem",eventItemOpened).on("closed",".InputfieldRepeaterItem",eventItemClosed).on("openReady",".InputfieldRepeaterItem",eventItemOpenReady).on("click",".InputfieldRepeaterInsertBefore",eventInsertBeforeClick).on("click",".InputfieldRepeaterInsertAfter",eventInsertAfterClick).on("mouseover",".InputfieldRepeaterInsertBefore",eventInsertMouseover).on("mouseover",".InputfieldRepeaterInsertAfter",eventInsertMouseover).on("mouseout",".InputfieldRepeaterInsertBefore",eventInsertMouseout).on("mouseout",".InputfieldRepeaterInsertAfter",eventInsertMouseout)}init()}jQuery(document).ready((function($){InputfieldRepeater($)}));